version: '3'
services:

  backend:
    build:
      context: backend/
      args:
        # A (THE?) way to pass args from command line via docker-compose to Dockerfile:
        # Set envvar, and use it immediately in docker-compose.
        # Win CMD (not tested): set BUILD_MODE="all" && docker-compose up ...
        # PowerShell: $env:BUILD_MODE="all" ; docker-compose up ...
        # Linux/Mac terminal: BUILD_MODE=all docker-compose up ...
        - BUILD_MODE
    volumes:
      - ./backend/corpora:/opt/host_corpora
    ports:
      # Korp backend server
      - "1234:1234"

  frontend:
    build:
      context: frontend/
      args:
        - BUILD_MODE
    depends_on:
      - backend
    volumes:
      - ./frontend:/opt/korp-frontend-config
    ports:
      # Korp frontend server
      - "9111:9111"
